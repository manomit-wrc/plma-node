{{#content "style" mode="prepend"}}
<link rel="stylesheet" type="text/css" href="/assets/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/select2.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-datetimepicker.min.css"> {{/content}}
<div class="page-wrapper">
  <div class="content container-fluid">
    <div class="row">
      <div class="col-xs-4">
        <h4 class="page-title">Budget Head</h4>
      </div>
      <div class="col-xs-8 text-right m-b-30">
        <a href="#" class="btn btn-primary rounded" data-toggle="modal" data-target="#add_user">
          <i class="fa fa-plus"></i> Add Budgets</a>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="table-responsive">
          <table class="table table-striped custom-table datatable" id="searchData">
            <thead>
              <tr>

                <th>Code</th>
                <th>Name</th>
                <th>Remarks</th>

                <th class="text-right">Action</th>
              </tr>
            </thead>

            <tbody id="mainTable">
              {{#each rows}}
              <tr>


                <td>{{this.code}}</td>
                <td>{{this.name}}</td>
                <td>{{this.remarks}}</td>

                <td class="text-right">
                  <div class="dropdown">
                    <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                      <i class="fa fa-ellipsis-v"></i>
                    </a>
                    <ul class="dropdown-menu pull-right">
                      <li>
                        <a href="/budgets/edit/{{this.id}}">
                          <i class="fa fa-pencil m-r-5"></i> Edit</a>
                      </li>

                      <li>
                        <a href="/budgets/delete/{{this.id}}">
                          <i class="fa fa-trash-o m-r-5"></i> Delete</a>
                      </li>
                    </ul>
                  </div>
                </td>
              </tr>
              {{/each}}

            </tbody>
          </table>



        </div>
      </div>
    </div>
  </div>

</div>
<!-- Add designation modal start -->
<div id="add_user" class="modal custom-modal fade" role="dialog">
  <div class="modal-dialog">
    <button type="button" class="close" data-dismiss="modal">&times;</button>
    <div class="modal-content modal-lg">
      <div class="modal-header">
        <h4 class="modal-title">Add Budget</h4>
      </div>
      <div class="modal-body">
        <form class="m-b-30" action="" id="frmAddFirm" method="post">
          <div class="row">
            <div class="col-md-12">
              <div class="form-group">
                <label class="control-label">Code :
                  <span class="text-danger">*</span>
                </label>
                <input class="form-control" type="text" id="code" name="code">
                <span id="uniqueCode" style="color: red; font-weight: bold;"> </span>
              </div>
            </div>
            <div class="col-md-12">
              <div class="form-group">
                <label class="control-label">Name:
                  <span class="text-danger">*</span>
                </label>
                <input class="form-control" type="text" id="name" name="name">
              </div>
            </div>
            <div class="col-md-12">
              <div class="form-group">
                <label class="control-label">Remarks :
                  <span class="text-danger">*</span>
                </label>
                <!-- <input class="form-control" type="text"> -->
                <textarea class="form-control" rows="12" id="remarks" name="remarks"></textarea>
              </div>
            </div>

          </div>

          <div class="m-t-20 text-center">
            <button class="btn btn-primary" id="btnAdd">Add BudgetHead</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Add designation modal ends -->

{{#content "script" mode="append"}}
<script type="text/javascript" src="/assets/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/assets/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/js/select2.min.js"></script>
<script type="text/javascript" src="/assets/js/moment.min.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap-datetimepicker.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.17.0/additional-methods.min.js"></script>
<script type="text/javascript">
  // add designation ajax and form validation starts
  $(document).ready(function (e) {

    $("#btnAdd").click(function () {
      $("#frmAddFirm").submit();
    });

    $("#frmAddFirm").validate({
      rules: {
        code: {
          required: true
        },
        name: {
          required: true
        }
      },
      messages: {
        code: {
          required: "Code can't be blank"
        },
        name: {
          required: "name title can't be blank"
        }
      },
      submitHandler: function (form) {
        var code = $('#code').val();
        var name = $('#name').val();
        var remarks = $('#remarks').val();
        $.ajax({
          type: "POST",
          url: "/budgets/addbudget",
          data: {
            code: code,
            name: name,
            remarks: remarks
          },
          beforeSend: function (xhr) {
            xhr.setRequestHeader('X-CSRF-Token', "{{csrfToken}}");


          },
          success: function (response) {
            if (response.msg === "ERRR") {
              document.getElementById('uniqueCode').innerHTML = "Code already been assigned";
            } else {
              window.location.href = '/budgets';
            }
          },
          error: function (xhr) {

          }
        });

      }
    });

    // add designation ajax operation and form validation ends

  });
</script>
<script type="text/javascript">
  function searchDataTable() {
    var code = $('#searchCode').val();
    var title = $('#searchName').val();
    $.ajax({
      url: '/budgets/search',
      method: 'POST',
      data: { code: code, Name: Name },
      success: function (resp) {
        // console.log(resp.searchData);

        // document.getElementById('mainTable').removeAttribute('class');
        document.getElementById('mainTable').style.display = "none";
        // $( "#removeDatatable" ).remove();
        // document.getElementById('mainTable').removeChild(document.getElementById('mainTable').childNodes[1]);
        // $( "#searchData" ).removeClass( "datatable" );
        //                          $('.datatable').dataTable({
        //     "bPaginate": false
        // });
        // document.getElementById('searchTable').style.display = "block";

        $.each(resp.searchData, function (key, value) {
          $("#searchData").append('<tbody   ><tr><td>' + value.code + '</td><td>' + value.name + '</td><td>' + value.remarks + '</td><td class="text-right"><div class="dropdown"><a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-ellipsis-v"></i></a><ul class="dropdown-menu pull-right"><li><a href="/designations/update/' + value.id + '" ><i class="fa fa-pencil m-r-5"></i> Edit</a></li><li><a href="/designations/delete/' + value.id + '"  ><i class="fa fa-trash-o m-r-5"></i>Delete</a></li></ul></div></td></tr></tbody   >');
        });
      },
      error: function (xhr) {

      }
    });
  }
</script> {{/content}}
