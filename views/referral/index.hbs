{{#content "style" mode="prepend"}}
<link rel="stylesheet" type="text/css" href="/assets/css/dataTables.bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/select2.min.css">
<link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-datetimepicker.min.css"> {{/content}}
<div class="page-wrapper">
    <div class="content container-fluid">
        <div class="pg-header">
            <div class="row">
                {{#if success_message}}
                <div class="alert alert-success">
                    <strong>Success! </strong>{{success_message}}
                </div>
                {{/if}} {{#if successEdit_message}}
                <div class="alert alert-success">
                    <strong>Success! </strong>{{successEdit_message}}
                </div>
                {{/if}} {{#if successDel_message}}
                <div class="alert alert-danger">
                    <strong>Success! </strong>{{successDel_message}}
                </div>
                {{/if}}
                <div class="col-xs-4">
                    <h4 class="page-title">Referral</h4>
                </div>
                <div class="col-xs-8 text-right">
                    <a href="/referral/add" class="btn btn-primary pull-right rounded">
                        <i class="fa fa-plus"></i> Add Referral</a>
                    <a href="#" class="btn btn-primary rounded mr-10" data-toggle="modal" data-target="#add_user">
                        <i class="fa fa-cloud-download"></i> Import Excel</a>

                </div>
            </div>
        </div>
        <div class="row filter-row">
            <form name="filter" method="GET">
                <div class="col-sm-3 col-xs-6">
                    <div class="form-group form-focus select-focus">
                        <label class="control-label">Target Type</label>
                        <select class="select floating" name="searchName">
                            <option value="">Select Target Type</option>
                            <option value="I" {{#if_eq searchName "I" }} selected="selected" {{/if_eq}}>Individual</option>
                            <option value="O" {{#if_eq searchName "O" }} selected="selected" {{/if_eq}}>Organisation</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-3 col-xs-6">
                    <div class="form-group form-focus">
                        <label class="control-label">Referral Email</label>
                        <input type="text" class="form-control floating" name="searchEmail" value="{{searchMail}}" />
                    </div>
                </div>
                <div class="col-sm-3 col-xs-6">
                    <input type="submit" value="Search" class="btn btn-success btn-block">
                </div>
                <div class="col-sm-3 col-xs-6">
                    <a href="/referral" class="btn btn-success btn-block"> Clear </a>
                </div>
            </form>
        </div>
        <div class="row">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table class="table table-striped custom-table datatable">
                        <thead>
                            <tr>
                                <th style="width:25%;">Referral Name</th>
                                <th>Referral Type</th>
                                <th>Email ID</th>
                                <th>Mobile Number</th>
                                <th class="text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each referral}}
                            <tr>
                                <td>
                                    {{#if_eq referral_type "I"}} {{this.first_name}} {{this.last_name}} {{/if_eq}} {{#if_eq referral_type "O"}} {{this.organization_name}}
                                    {{/if_eq}}
                                </td>
                                <td>
                                    {{#if_eq referral_type "I"}} Individual {{/if_eq}} {{#if_eq referral_type "O"}} Organization {{/if_eq}}
                                </td>
                                <td>{{this.email}}</td>
                                <td class="number_validator">{{this.mobile}}</td>
                                <td class="text-right">
                                    <div class="dropdown">
                                        <a href="#" class="action-icon dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                            <i class="fa fa-ellipsis-v"></i>
                                        </a>
                                        <ul class="dropdown-menu pull-right">
                                            <li>
                                                <a href="/referral/edit/{{this.id}}">
                                                    <i class="fa fa-pencil m-r-5"></i> Edit</a>
                                            </li>
                                            <li>
                                                <a href="/referral/delete/{{this.id}}">
                                                    <i class="fa fa-trash-o m-r-5"></i> Delete</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            {{/each}}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>
<div id="add_user" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h4 class="modal-title">Import Excel</h4>
            </div>
            <div class="modal-body">
                <div class="card-box">
                    <form class="m-b-10 uploadExcel" name="upload_excel" id="upload_excel" method="POST" action="/referral/upload-excel" enctype="multipart/form-data">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <div class="m-t-10">
                                        <input type="file" name="ref_excel_file" id="ref_excel_file" class="inputfile inputfile-6" onchange="return fileValidation()"
                                        />
                                        <label for="ref_excel_file">
                                            <span></span>
                                            <strong>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17">
                                                    <path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"
                                                    />
                                                </svg> Choose a file&hellip;</strong>
                                        </label>
                                    </div>
                                </div>
                                <span class="err_span" id="error_msg">Choose a file to enable button</span>
                            </div>
                        </div>
                        <div class="m-t-20 text-center">
                            <button class="btn btn-primary" type="submit" id="btnUploadXls" disabled>Upload File</button>
                            <br/>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{{#content "script" mode="append"}}
<script type="text/javascript" src="/assets/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/assets/js/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/js/select2.min.js"></script>
<script type="text/javascript" src="/assets/js/moment.min.js"></script>
<script type="text/javascript" src="/assets/js/bootstrap-datetimepicker.min.js"></script>
<script type="text/javascript">
    'use strict';

    ; (function (document, window, index) {
        var inputs = document.querySelectorAll('.inputfile');
        Array.prototype.forEach.call(inputs, function (input) {
            var label = input.nextElementSibling,
                labelVal = label.innerHTML;

            input.addEventListener('change', function (e) {
                var fileName = '';
                if (this.files && this.files.length > 1)
                    fileName = (this.getAttribute('data-multiple-caption') || '').replace('{count}', this.files.length);
                else
                    fileName = e.target.value.split('\\').pop();

                if (fileName)
                    label.querySelector('span').innerHTML = fileName;
                else
                    label.innerHTML = labelVal;
            });

            // Firefox bug fix
            input.addEventListener('focus', function () { input.classList.add('has-focus'); });
            input.addEventListener('blur', function () { input.classList.remove('has-focus'); });
        });
    }(document, window, 0));

    function fileValidation() {
        document.getElementById("error_msg").innerHTML = "Choose a file to enable button";
        document.getElementById("btnUploadXls").disabled = true;
        var fileInput = document.getElementById('ref_excel_file');
        var filePath = fileInput.value;
        var allowedExtensions = /(\.xlsx|\.xls)$/i;
        if (!allowedExtensions.exec(filePath)) {
            document.getElementById("error_msg").innerHTML = "Please upload file having extensions .xlsx or .xls only.";
            fileInput.value = '';
            return false;
        } else {
            document.getElementById("btnUploadXls").disabled = false;
            document.getElementById("error_msg").innerHTML = "";
            return true;
        }
    }
</script> {{/content}}